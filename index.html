<!DOCTYPE html>
<html lang="ja">

<head>
    <!--文字コード・互換モード-->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
    <title>トップぺージ | 水戸一高附属中総合ウェブサイト</title>
    <!--ビューポート-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--css-->
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.2/css/all.css">
    <link rel="stylesheet" href="./script/notice/notice.css">
    <style>
        #timetable-wrapper {
            width: calc(100% - 2rem);
            aspect-ratio: 4 / 3;
            overflow: hidden;
            position: relative;
            border-radius: 8px;
        }

        #timetable-wrapper img {
            width: calc(200% + 20px);
            object-fit: cover;
            object-position: left top;
            display: block;
            cursor: pointer;
        }

        #timetable-loading {
            display: block;
        }

        #timetable-fullview {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        #timetable-fullview img {
            max-width: 90vw;
            max-height: 90vh;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
    </style>
    <!--web情報-->
    <meta name="keywords" content="水戸一, 水戸一附属, 水戸一附属中, 一学年,">
    <meta name="description" content="水戸一附属中生向けの総合ウェブサイトです。附属中向けの掲示板や質問箱を運営しています。">
    <meta name="author" content="©️ 2025 talus">
    <!--更新日時-->
    <meta name="date" content="2025-02-28">
    <meta name="creation_date" content="2025-02-19">
    <!--URL-->
    <link rel="canonical" href="https://talus-yujiro.github.io/mito1-website/">
    <!--アイコン-->
    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="./img/mitoichi-fuzoku-180x180.png" sizes="180x180">
    <!--windows-->
    <meta name="msapplication-config" content="none">
    <meta name="msapplication-TileImage" content="./img/mitoichi-fuzoku.png">
    <!--safari-->
    <link rel="mask-icon" href="">
    <!--Android-->
    <meta name="theme-color" content="#3498db">
    <link rel="icon" type="image/png" href="./img/mitoichi-fuzoku-192x192.png" sizes="192x192">
    <!--CDN-->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.35.4"></script>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!--マニフェスト-->
    <link rel="manifest" href="manifest.json">
</head>

<body>
    <header>
        <h1>
            <a href="./">水戸一高附属中総合ウェブサイト</a>
        </h1>
    </header>
    <main>
        <section class="main__classlist">
            <h2>時間割</h2>
            <img src="" alt="時間割画像" id="timetable">
            <p>※時間割が表示されない場合、<a href="./timetable/">過去の時間割</a>や<a href="./faq.html#timetable-error:~:text=%E3%82%82%E3%81%82%E3%82%8A%E3%81%BE%E3%81%9B%E3%82%93%E3%80%82-,%E6%99%82%E9%96%93%E5%89%B2%E3%81%8C%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%A7%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84,-%E6%99%82%E9%96%93%E5%89%B2%E3%81%8C%E8%A6%8B">よくある質問</a>を参照してください。</p>
        </section>
        <section>
            <h2>サイト概要</h2>
            <p>
                水戸一高附属中生に向けた総合ウェブサイトです。主に掲示板や知恵袋サービスを運営しています。<br>
                更に使いやすいサイトになれるよう、頑張っていきますので、今後ともよろしくお願いします。
            </p>
        </section>
        <section>
            <h2>お問い合わせ</h2>
            <p><b>よくある質問は<a href="./faq.html">こちら</a>をご覧ください。</b></p>
            <p>
                サイトに関する要望があれば
                <a href="mailto:yamamoto.yuujirou@mito1-h.ibk.ed.jp?subject=ウェブサイトについての要望&body=要望の内容:%0D%0A%0D%0A不具合の報告の場合は以下の情報もご記入ください。%0D%0A- 使用端末（例: Windows PC, iPad, スマートフォンなど）%0D%0A- 使用ブラウザ（例: Chrome, Safari, Edgeなど）%0D%0A- 発生日時（例: 2025年2月28日 14:30頃）%0D%0A- スクリーンショットなどがあると尚良いです。%0D%0A- 不具合の詳細な説明:"
                    target="_blank" rel="noopener noreferrer">yamamoto.yuujirou@mito1-h.ibk.ed.jp</a>
                もしくは以下のフォームまで
            </p>
            <hr>
            <h3><a href="https://docs.google.com/forms/d/e/1FAIpQLSda7T_NJjbBKJkGJ839RP9A4gn1P7QEO5XnTq13EJshxgjxTA/viewform"
                    target="_blank" rel="noopener noreferrer">バグ報告フォーム</a></h3>
            <iframe
                src="https://docs.google.com/forms/d/e/1FAIpQLSda7T_NJjbBKJkGJ839RP9A4gn1P7QEO5XnTq13EJshxgjxTA/viewform?embedded=true"
                width="90%" height="924" frameborder="0" marginheight="0" marginwidth="0">読み込んでいます…</iframe>
        </section>
        <section>
            <h2>About Us</h2>
            <p>
                水戸一高附属中総合ウェブサイトでは、附属中生徒が利用しやすく、学習や生活面での課題を解決できるようなサイトを目指して、日々開発に励んでいます。<br>
                主に2Aの有志で運営しており、主に<a href="./timetable/">時間割</a>の配信や<a href="./bbs/">掲示板</a>、<a
                    href="./question/">質問箱</a>などのサービスを展開しています。<br>
                現在人手が大変足りていない状況なので、サイト運営に興味がある方はぜひ<a
                    href="mailto:yamamoto.yuujirou@mito1-h.ibk.ed.jp?subject=サイト運営について&body=サイト運営に関わりたい場合、以下に名前、学籍番号、理由（自由記述）を記入してメールを送信してください。"
                    target="_blank" rel="noopener noreferrer">メール</a>などでお知らせください！
            </p>
        </section>
    </main>

    <footer>
        <p>© 2025 talus</p>
        <p>※このサイトは学校非公認の個人が運営しているサイトです。学校側の問題に責任は取れませんのでご注意ください。</p>
        <p>
            <a href="https://www.mito1-jh.ibk.ed.jp" target="_blank" rel="noopener noreferrer">茨城県立水戸第一高等学校附属中学校HP</a>
        </p>
    </footer>

    <script>
        const imgEl = document.getElementById('timetable');
        const FILENAME_RE = /(\d{6,8})-(\d{6})(?:-(\d+))?\.jpg$/i;

        // ファイル名を解析
        function parseFilename(filename) {
            const m = filename.match(FILENAME_RE);
            if (!m) return null;

            let [, datePart, timePart, indexPart] = m;
            if (datePart.length === 6) datePart = '20' + datePart;

            const y = datePart.slice(0, 4);
            const mo = datePart.slice(4, 6);
            const d = datePart.slice(6, 8);
            const hh = timePart.slice(0, 2);
            const mm = timePart.slice(2, 4);
            const ss = timePart.slice(4, 6);

            const date = new Date(`${y}-${mo}-${d}T${hh}:${mm}:${ss}Z`);
            if (isNaN(date.getTime())) return null;

            return { date, index: Number(indexPart) };
        }

        // 最新画像を取得して表示
        async function updateLatestImage(baseUrl = 'https://mito1-website.loca.lt/') {
            // 読み込み中表示
            let loadingEl = document.getElementById('timetable-loading');
            if (!loadingEl) {
                loadingEl = document.createElement('p');
                loadingEl.id = 'timetable-loading';
                loadingEl.textContent = '読み込み中…';
                imgEl.insertAdjacentElement('afterend', loadingEl);
            }

            imgEl.style.display = 'none';

            try {
                const res = await fetch(baseUrl);
                if (!res.ok) throw new Error('一覧取得失敗');

                const htmlText = await res.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');
                const anchors = Array.from(doc.querySelectorAll('a[href]'));

                const candidates = anchors.map(a => {
                    const href = a.getAttribute('href');
                    if (!href) return null;

                    const filename = href.split('/').pop();
                    const parsed = parseFilename(filename);
                    if (!parsed) return null;

                    return {
                        url: (new URL(href, baseUrl)).href,
                        filename,
                        date: parsed.date,
                        index: parsed.index
                    };
                }).filter(Boolean)
                    .sort((a, b) => (b.date - a.date) || (b.index - a.index));

                if (candidates.length === 0) throw new Error('jpgファイルが見つかりません');

                const latest = candidates[0];
                const imgRes = await fetch(latest.url);
                if (!imgRes.ok) throw new Error('画像取得失敗');

                const blob = await imgRes.blob();
                imgEl.src = URL.createObjectURL(blob);
                imgEl.alt = latest.filename;

                // wrapper作成
                let wrapper = imgEl.parentNode.querySelector('#timetable-wrapper');
                if (!wrapper) {
                    wrapper = document.createElement('div');
                    wrapper.id = 'timetable-wrapper';
                    imgEl.parentNode.insertBefore(wrapper, imgEl);
                    wrapper.appendChild(imgEl);
                }

                imgEl.style.display = 'block';
                loadingEl.remove();

                console.info('最新画像を更新:', latest.filename);
            } catch (err) {
                console.error(err);
                loadingEl.textContent = '画像取得に失敗しました';
            }
        }

        // 拡大表示
        imgEl.addEventListener('click', () => {
            let existing = document.getElementById('timetable-fullview');
            if (existing) existing.remove();

            const fullView = document.createElement('div');
            fullView.id = 'timetable-fullview';

            const img = document.createElement('img');
            img.src = imgEl.src;
            img.alt = imgEl.alt;

            fullView.appendChild(img);
            document.body.appendChild(fullView);

            fullView.addEventListener('click', () => fullView.remove());
        });

        updateLatestImage();
    </script>
    <script type="module" src="./script/notice/notice.js"></script>
    <script src="./script/customAlert.js" type="module"></script>
    <script type="module" src="./script/restriction.js"></script>
    <script type="module" src="./script/notification.js"></script>
    <script src="./script/verification.js"></script>
    <script data-goatcounter="https://talus.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>

</html>
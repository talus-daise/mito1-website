<!DOCTYPE html>
<html lang="ja">

<head>
    <!--文字コード・互換モード-->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
    <title>トップぺージ | 水戸一高附属中総合ウェブサイト</title>
    <!--ビューポート-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--css-->
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.2/css/all.css">
    <link rel="stylesheet" href="./script/notice/notice.css">
    <!--web情報-->
    <meta name="keywords" content="水戸一, 水戸一附属, 水戸一附属中, 一学年,">
    <meta name="description" content="水戸一附属中生向けの総合ウェブサイトです。附属中向けの掲示板や質問箱を運営しています。">
    <meta name="author" content="©️ 2025 talus">
    <!--更新日時-->
    <meta name="date" content="2025-02-28">
    <meta name="creation_date" content="2025-02-19">
    <!--URL-->
    <link rel="canonical" href="https://talus-yujiro.github.io/mito1-website/">
    <!--アイコン-->
    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="./img/mitoichi-fuzoku-180x180.png" sizes="180x180">
    <!--windows-->
    <meta name="msapplication-config" content="none">
    <meta name="msapplication-TileImage" content="./img/mitoichi-fuzoku.png">
    <!--safari-->
    <link rel="mask-icon" href="">
    <!--Android-->
    <meta name="theme-color" content="#3498db">
    <link rel="icon" type="image/png" href="./img/mitoichi-fuzoku-192x192.png" sizes="192x192">
    <!--CDN-->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.35.4"></script>
    <script src="./script/customAlert.js" type="module"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!--マニフェスト-->
    <link rel="manifest" href="manifest.json">
</head>

<body>
    <header>
        <h1>
            <a href="./">水戸一高附属中総合ウェブサイト</a>
        </h1>
    </header>
    <main>
        <section class="main__classlist">
            <h2>時間割</h2>
            <img src="" alt="時間割画像" id="timetable">
            <a href="./timetable/">過去の時間割など</a>
        </section>
        <section>
            <h2>サイト概要</h2>
            <p>
                水戸一高附属中生に向けた総合ウェブサイトです。主に掲示板や知恵袋サービスを運営しています。<br>
                更に使いやすいサイトになれるよう、頑張っていきますので、今後ともよろしくお願いします。
            </p>
        </section>
        <section class="highlight">
            <h2>スパムについて</h2>
            <p>このサイトではスパム行為を禁止しています。スパム行為が発覚した場合、サイトへのアクセスを制限させてもらうことがありますので、ご了承ください。</p>
            <p><s>あと普通に消すのめんどくさいからやめて</s></p>
        </section>
        <section>
            <h2>お問い合わせ</h2>
            <p><b>よくある質問は<a href="./faq.html">こちら</a>をご覧ください。</b></p>
            <p>
                サイトに関する要望があれば
                <a href="mailto:yamamoto.yuujirou@mito1-h.ibk.ed.jp?subject=ウェブサイトについての要望&body=要望の内容:%0D%0A%0D%0A不具合の報告の場合は以下の情報もご記入ください。%0D%0A- 使用端末（例: Windows PC, iPad, スマートフォンなど）%0D%0A- 使用ブラウザ（例: Chrome, Safari, Edgeなど）%0D%0A- 発生日時（例: 2025年2月28日 14:30頃）%0D%0A- スクリーンショットなどがあると尚良いです。%0D%0A- 不具合の詳細な説明:"
                    target="_blank" rel="noopener noreferrer">yamamoto.yuujirou@mito1-h.ibk.ed.jp</a>
                もしくは以下のフォームまで
            </p>
            <hr>
            <h3><a href="https://docs.google.com/forms/d/e/1FAIpQLSda7T_NJjbBKJkGJ839RP9A4gn1P7QEO5XnTq13EJshxgjxTA/viewform"
                    target="_blank" rel="noopener noreferrer">バグ報告フォーム</a></h3>
            <iframe
                src="https://docs.google.com/forms/d/e/1FAIpQLSda7T_NJjbBKJkGJ839RP9A4gn1P7QEO5XnTq13EJshxgjxTA/viewform?embedded=true"
                width="90%" height="924" frameborder="0" marginheight="0" marginwidth="0">読み込んでいます…</iframe>
        </section>
        <section>
            <h2>About Us</h2>
            <p>
                水戸一高附属中総合ウェブサイトでは、附属中生徒が利用しやすく、学習や生活面での課題を解決できるようなサイトを目指して、日々開発に励んでいます。<br>
                主に2Aの有志で運営しており、主に時間割の配信や掲示板、質問箱などのサービスを展開しています。<br>
                現在人手が大変足りていない状況なので、サイト運営に興味がある方はぜひメールなどでお知らせください！
            </p>
        </section>
    </main>

    <footer>
        <p>© 2025 talus</p>
        <p>※このサイトは学校非公認の個人が運営しているサイトです。学校側の問題に責任は取れませんのでご注意ください。</p>
        <p>
            <a href="https://www.mito1-jh.ibk.ed.jp" target="_blank" rel="noopener noreferrer">茨城県立水戸第一高等学校附属中学校HP</a>
        </p>
    </footer>

    <script>
        const imgEl = document.getElementById('timetable');

        const FILENAME_RE = /(\d{6,8})-(\d{6})-(\d+)\.jpg$/i;

        function parseFilename(filename) {
            const m = filename.match(FILENAME_RE);
            if (!m) return null;

            let [, datePart, timePart, indexPart] = m;
            if (datePart.length === 6) datePart = '20' + datePart;

            const y = datePart.slice(0, 4);
            const mo = datePart.slice(4, 6);
            const d = datePart.slice(6, 8);
            const hh = timePart.slice(0, 2);
            const mm = timePart.slice(2, 4);
            const ss = timePart.slice(4, 6);

            const date = new Date(`${y}-${mo}-${d}T${hh}:${mm}:${ss}Z`);
            if (isNaN(date.getTime())) return null;

            return { date, index: Number(indexPart) };
        }

        function updateLatestImage(baseUrl) {
            baseUrl = baseUrl || 'https://mito1-website.loca.lt/';
            const imgEl = document.getElementById('timetable');

            imgEl.style.display = 'none';
            imgEl.insertAdjacentHTML('afterend', "<span>読み込み中…</span>");

            const xhr = new XMLHttpRequest();
            xhr.open("GET", baseUrl, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState !== 4) return;

                if (xhr.status !== 200) {
                    console.error("一覧取得失敗:", xhr.status);
                    return;
                }

                const parser = new DOMParser();
                const doc = parser.parseFromString(xhr.responseText, 'text/html');
                const anchors = Array.prototype.slice.call(doc.querySelectorAll('a[href]'));

                const candidates = anchors.map(function (a) {
                    const href = a.getAttribute('href');
                    if (!href) return null;

                    const filename = href.split('/').pop();
                    const m = filename.match(FILENAME_RE);
                    if (!m) return null;

                    const [, datePartRaw, timePart, indexPart] = m;
                    const datePart = datePartRaw.length === 6 ? '20' + datePartRaw : datePartRaw;

                    const y = datePart.slice(0, 4);
                    const mo = datePart.slice(4, 6);
                    const d = datePart.slice(6, 8);
                    const hh = timePart.slice(0, 2);
                    const mm = timePart.slice(2, 4);
                    const ss = timePart.slice(4, 6);

                    const date = new Date(`${y}-${mo}-${d}T${hh}:${mm}:${ss}Z`);
                    return {
                        url: (new URL(href, baseUrl)).href,
                        filename: filename,
                        date: date,
                        index: Number(indexPart),
                    };
                }).filter(Boolean).sort(function (a, b) {
                    return (b.date - a.date) || (b.index - a.index);
                });

                if (candidates.length === 0) {
                    console.error("jpgファイルが見つかりません");
                    return;
                }

                const latest = candidates[0];

                const xhrImg = new XMLHttpRequest();
                xhrImg.open("GET", latest.url, true);
                xhrImg.responseType = "blob";
                xhrImg.onreadystatechange = function () {
                    if (xhrImg.readyState !== 4) return;

                    if (xhrImg.status !== 200) {
                        console.error("画像取得失敗:", xhrImg.status);
                        return;
                    }

                    const blobURL = URL.createObjectURL(xhrImg.response);
                    imgEl.src = blobURL;
                    imgEl.alt = latest.filename;

                    const wrapper = document.createElement('div');
                    imgEl.parentNode.insertBefore(wrapper, imgEl);
                    wrapper.appendChild(imgEl);

                    wrapper.style.width = "calc(100% - 2rem)";
                    wrapper.style.aspectRatio = "4 / 3";
                    wrapper.style.overflow = "hidden";
                    wrapper.style.position = "relative";
                    wrapper.style.borderRadius = "8px";

                    imgEl.style.width = "calc(200% + 20px)";
                    imgEl.style.objectFit = "cover";
                    imgEl.style.objectPosition = "left top";
                    imgEl.style.display = "block";
                    imgEl.style.cursor = "pointer";

                    imgEl.style.display = 'block';
                    wrapper.nextElementSibling.remove();

                    console.info("最新画像を更新:", latest.filename);
                };
                xhrImg.send();
            };
            xhr.send();
        }

        updateLatestImage();

        imgEl.addEventListener('click', function () {
            const fullView = document.createElement('div');
            fullView.style.position = 'fixed';
            fullView.style.top = 0;
            fullView.style.left = 0;
            fullView.style.width = '100vw';
            fullView.style.height = '100vh';
            fullView.style.backgroundColor = 'rgba(0,0,0,0.8)';
            fullView.style.display = 'flex';
            fullView.style.alignItems = 'center';
            fullView.style.justifyContent = 'center';
            fullView.style.zIndex = 9999;

            const img = document.createElement('img');
            img.src = imgEl.src;
            img.alt = imgEl.alt;
            img.style.maxWidth = '90vw';
            img.style.maxHeight = '90vh';
            img.style.borderRadius = '8px';
            img.style.boxShadow = '0 0 20px rgba(0,0,0,0.5)';

            fullView.appendChild(img);
            document.body.appendChild(fullView);

            fullView.addEventListener('click', function () {
                fullView.remove();
            });
        });
    </script>
    <script type="module" src="./script/notice/notice.js"></script>
    <script src="./script/customAlert.js" type="module"></script>
    <script src="./script/verification.js"></script>
    <script data-goatcounter="https://talus.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>

</html>
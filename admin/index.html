<!DOCTYPE html>
<html lang="ja">

<head>
    <!--文字コード・互換モード-->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
    <title>管理者用 | 水戸一高附属中総合ウェブサイト</title>
    <!--ビューポート-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--css-->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.2/css/all.css">
    <link rel="stylesheet" href="../script/notice/notice.css">
    <!--web情報-->
    <meta name="keywords" content="水戸一, 水戸一附属, 水戸一附属中, 一学年,">
    <meta name="description" content="水戸一附属中生向けの総合ウェブサイトです。附属中向けの掲示板や質問箱を運営しています。">
    <meta name="author" content="©️ 2025 talus">
    <!--更新日時-->
    <meta name="date" content="2025-02-28">
    <meta name="creation_date" content="2025-02-19">
    <!--URL-->
    <link rel="canonical" href="https://talus-yujiro.github.io/mito1-website/">
    <!--アイコン-->
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="../img/mitoichi-fuzoku-180x180.png" sizes="180x180">
    <!--windows-->
    <meta name="msapplication-config" content="none">
    <meta name="msapplication-TileImage" content="../img/mitoichi-fuzoku.png">
    <!--safari-->
    <link rel="mask-icon" href="">
    <!--Android-->
    <meta name="theme-color" content="#3498db">
    <link rel="icon" type="image/png" href="../img/mitoichi-fuzoku-192x192.png" sizes="192x192">
    <!--CDN-->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.35.4"></script>
    <!--マニフェスト-->
    <link rel="manifest" href="../manifest.json">
</head>

<body>
    <header>
        <h1>管理者用ページ</h1>
    </header>
    <main>
        <section>
            <h2>管理者用ページ</h2>
            <p id="auth-status">認証中です</p>
        </section>
    </main>

    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

        const supabase = createClient(
            "https://mgsbwkidyxmicbacqeeh.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nc2J3a2lkeXhtaWNiYWNxZWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDA0MjIsImV4cCI6MjA1NTUxNjQyMn0.fNkFQykD9ezBirtJM_fOB7XEIlGU1ZFoejCgrYObElg"
        );

        async function checkAdmin() {
            const user = await supabase.auth.getUser();
            const authStatus = document.getElementById("auth-status");

            if (user.data.user) {
                const { data: users, error } = await supabase
                    .from("users")
                    .select("role")
                    .eq("user_id", user.data.user.id)
                    .single();

                if (error) {
                    authStatus.textContent = "エラーが発生しました。";
                    console.error("プロフィール取得エラー:", error);
                    return;
                }

                switch (users.role) {
                    case "master":
                    case "admin":
                        authStatus.textContent = "管理者として認証されました。";
                        // 管理者用機能を表示するコードをここに追加
                        const adminFeatures = document.createElement("section");
                        adminFeatures.innerHTML = `
                        <h2>管理者用機能</h2>
                        <ul>
                            <li><a href="./user_manage/"><i class="fa-solid fa-user"></i>ユーザー管理</a></li>
                            <li><a href="./content_manage/"><i class="fa-solid fa-file"></i>コンテンツ管理</a></li>
                            <li><a href="./website_allow/"><i class="fa-solid fa-check"></i>ウェブサイト許可管理</a></li>
                            <li><a href="./request_music/"><i class="fa-solid fa-music"></i>リクエスト曲管理</a></li>
                        </ul>
                    `;
                        document.querySelector("main").appendChild(adminFeatures);
                        break;
                    case "manager":
                        authStatus.textContent = "サイトマネージャーとして認証されました。";
                        // コンテンツ管理者用機能を表示するコードをここに追加
                        const contentManagerFeatures = document.createElement("section");
                        contentManagerFeatures.innerHTML = `
                        <h2>サイトマネージャー用機能</h2>
                        <ul>
                            <li><a href="./user_manage/">ユーザー管理</a></li>
                            <li><a href="./content_manage/">コンテンツ管理</a></li>
                            <li><a href="./website_allow/">ウェブサイト許可管理</a></li>
                        </ul>
                    `;
                        document.querySelector("main").appendChild(contentManagerFeatures);
                        break;
                    case "request_music_manager":
                        authStatus.textContent = "リクエスト曲管理者として認証されました。";
                        // リクエスト曲管理者用機能を表示するコードをここに追加
                        const musicManagerFeatures = document.createElement("section");
                        musicManagerFeatures.innerHTML = `
                        <h2>リクエスト曲管理者用機能</h2>
                        <ul>
                            <li><a href="./request_music/">リクエスト曲管理</a></li>
                        </ul>
                    `;
                        document.querySelector("main").appendChild(musicManagerFeatures);
                        break;
                    default:
                        authStatus.textContent = "管理者権限がありません。";
                }
            } else {
                authStatus.textContent = "ログインしていません。";
            }
        }

        document.addEventListener("DOMContentLoaded", checkAdmin);
    </script>
    <script type="module" src="../script/notice/notice.js"></script>
    <script src="../script/customAlert.js" type="module"></script>
    <script type="module" src="../script/restriction.js"></script>
    <script type="module" src="../script/notification.js"></script>
    <script src="../script/verification.js" type=module></script>

    <script data-goatcounter="https://talus.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
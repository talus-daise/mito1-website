<!DOCTYPE html>
<html lang="ja">

<head>
    <!--文字コード・互換モード-->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge, chrome=1">
    <title>名簿 | 水戸一高附属中総合ウェブサイト</title>
    <!--ビューポート-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--css-->
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.2/css/all.css">
    <link rel="stylesheet" href="../notice/notice.css">
    <!--web情報-->
    <meta name="keywords" content="水戸一, 水戸一附属, 水戸一附属中, 一学年,">
    <meta name="description" content="水戸一附属中生向けの総合ウェブサイトです。附属中向けの掲示板や質問箱を運営しています。">
    <meta name="author" content="©️ 2025 talus">
    <!--更新日時-->
    <meta name="date" content="2025-02-28">
    <meta name="creation_date" content="2025-02-19">
    <!--URL-->
    <link rel="canonical" href="https://talus-yujiro.github.io/mito1-website/">
    <!--アイコン-->
    <link rel="shortcut icon" href="../img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="../img/mitoichi-fuzoku-180x180.png" sizes="180x180">
    <!--windows-->
    <meta name="msapplication-config" content="none">
    <meta name="msapplication-TileImage" content="../img/mitoichi-fuzoku.png">
    <!--safari-->
    <link rel="mask-icon" href="">
    <!--Android-->
    <meta name="theme-color" content="#3498db">
    <link rel="icon" type="image/png" href="../img/mitoichi-fuzoku-192x192.png" sizes="192x192">
    <!--CDN-->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.35.4"></script>
    <script src="../script/customAlert.js" type="module"></script>
    <!--マニフェスト-->
    <link rel="manifest" href="../manifest.json">
</head>

<body>
    <header>
        <h1>
            <a href="../">水戸一高附属中総合ウェブサイト</a>
        </h1>
        <p class="header__breadcrumb">
            <a href="../">
                <i class="fa-solid fa-house"></i>トップページ</a>
            <a href="./">
                <i class="fa-solid fa-clipboard-list"></i>名簿</a>
        </p>
    </header>
    <main>
        <h1>名簿</h1>
        <section>
            <h2>検索</h2>
            <label for="search-box">検索：<input type="text" id="search-box" placeholder="名前や番号で検索..."></label>
            <button id="search-btn">検索</button>
        </section>
        <section class="main__student">
            <h2>生徒</h2>
            <table>
                <thead>
                    <tr>
                        <th>学籍番号</th>
                        <th>名前</th>
                    </tr>
                </thead>
                <tbody id="roster"></tbody>
            </table>
        </section>
        <section>
            <h2>先生方</h2>
            <h3>1学年担任</h3>
            <p>主任 綿引利弘</p>
            <p>副主任 阿内文弘</p>
            <p>担任 鳴井柚紀</p>
            <p>担任 岡崎翔太</p>
            <hr>
            <h3>2学年担任</h3>
            <p>主任 羽成文江</p>
            <p>副主任 浅野玲子</p>
            <p>担任 渡邊大介</p>
            <p>担任 藤田忠弘</p>
            <hr>
            <h3>3学年担任</h3>
            <p>主任 丸山聡一郎</p>
            <p>副主任 矢崎寛子</p>
            <p>担任 白石拓史</p>
            <p>担任 石田竜祐</p>
            <hr>
            <h3>英語</h3>
            <p>Super 白石拓史</p>
            <p>Advance 鳴井柚紀</p>
            <p>Basic 浅野玲子</p>
            <p>E2 Andres Gonzales</p>
            <hr>
            <h3>数学</h3>
            <p>発展 平塚祐二</p>
            <p>応用 羽成文江</p>
            <p>基礎 綿引利弘</p>
            <hr>
            <h3>国語</h3>
            <p>A 阿内文弘</p>
            <p>B 矢崎寛子</p>
            <hr>
            <h3>理科</h3>
            <p>R1 木村由佳</p>
            <p>R2 藤田忠弘</p>
            <hr>
            <h3>社会</h3>
            <p>地理 丸山聡一郎</p>
            <p>歴史 岡崎翔太</p>
            <hr>
            <h3>体育</h3>
            <p>渡邊大介</p>
            <p>石田竜祐</p>
            <hr>
            <h3>技術</h3>
            <p>清浦昌之</p>
            <hr>
            <h3>家庭</h3>
            <p>柴田京子</p>
            <p>川井美穂</p>
            <hr>
            <h3>美術</h3>
            <p>武本夏子</p>
            <hr>
            <h3>音楽</h3>
            <p>小沼みのり</p>
            <hr>
            <p>(以上敬称略)</p>
        </section>
    </main>
    <footer>
        <p>© 2025 talus</p>
        <p>※このサイトは学校非公認の個人が運営しているサイトです。学校側の問題に責任は取れませんのでご注意ください。</p>
        <p>
            <a href="https://www.mito1-jh.ibk.ed.jp" target="_blank" rel="noopener noreferrer">茨城県立水戸第一高等学校附属中学校HP</a>
        </p>
    </footer>

    <script type="module" src="../notice/notice.js"></script>
    <script src="../script/customAlert.js" type="module"></script>
    <!--マニフェスト-->
    <link rel="manifest" href="../manifest.json">
    <script src="../script/verification.js"></script>
    <script data-goatcounter="https://talus.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <script type="module">
        import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

        const supabase = createClient(
            "https://mgsbwkidyxmicbacqeeh.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1nc2J3a2lkeXhtaWNiYWNxZWVoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk5NDA0MjIsImV4cCI6MjA1NTUxNjQyMn0.fNkFQykD9ezBirtJM_fOB7XEIlGU1ZFoejCgrYObElg"
        );

        fetch('../names.json')
            .then(response => response.json())
            .then(async data => {
                const rosterBody = document.getElementById('roster');
                const searchBox = document.getElementById('search-box');
                const searchBtn = document.getElementById('search-btn');

                const { data: { session } } = await supabase.auth.getSession();

                if (!session || !session.user) {
                    showCustomAlert("名簿を見るにはログインが必要です。");
                    return;
                }

                let students = [];

                // クラスごとの生徒データを結合
                for (const className in data) {
                    const names = data[className];
                    names.forEach((name, index) => {
                        students.push({
                            number: `${className}${String(index + 1).padStart(2, '0')}`,
                            name: name
                        });
                    });
                }

                // 名簿表示関数
                async function displayRoster(filteredStudents) {
                    const { data: users, error} = await supabase
                        .from("users")
                        .select("full_name, user_id");
                    
                    rosterBody.innerHTML = '';
                    filteredStudents.forEach(student => {
                        const row = document.createElement('tr');
                        const numberCell = document.createElement('td');
                        const nameCell = document.createElement('td');

                        numberCell.textContent = student.number;
                        nameCell.textContent = student.name;

                        if (student.name === session.user.user_metadata.full_name) {
                            row.style.backgroundColor = '#fffbcc'; // ハイライト色
                        }

                        const user = users.find(u => u.full_name === student.name);
                        if (user) {
                            const userLink = document.createElement('a');
                            userLink.href = `/mito1-website/mypage/other/?user_id=${encodeURIComponent(user.user_id)}`;
                            userLink.textContent = student.name;
                            nameCell.innerHTML = ''; // Clear the cell
                            nameCell.appendChild(userLink);
                        }

                        row.appendChild(numberCell);
                        row.appendChild(nameCell);
                        rosterBody.appendChild(row);
                    });
                }

                // 初期表示
                displayRoster(students);

                // 検索機能
                searchBtn.addEventListener('click', () => {
                    const query = searchBox.value.toLowerCase();
                    const filteredStudents = students.filter(student =>
                        student.name.toLowerCase().includes(query) ||
                        student.number.toLowerCase().includes(query)
                    );
                    displayRoster(filteredStudents);
                });
            })
            .catch(error => console.error('Error loading names:', error));

        // Removed duplicate search handler that referenced undefined `tbody`;
        // search is handled using the roster data inside the fetch callback above.

        document.getElementById("search-box").addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                document.getElementById("search-btn").click();
            }
        });
    </script>
</body>

</html>